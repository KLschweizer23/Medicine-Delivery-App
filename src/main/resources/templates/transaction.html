<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <th:block th:replace="components/header :: header"></th:block>
        <title>Transaction - My Orders</title>
    </head>
    <body class="bg-primary-theme" style="background-color: black;">
        <nav th:replace="fragments/navbar :: navbar"></nav>
        <div class="text-center p-5">
            <div class="bg-white p-2">
                <h4 class="text-dark text-left">Delivery Address</h4>
                <div class="text-left text-dark w-100 m-0 mb-5 p-2">
                  <div class="row">
                    <div class="col-12 col-md-4">
                      <h6 th:text="${transaction.user.firstName} + ' ' + ${transaction.user.lastName}" class="m-0 p-0"><b>Name</b></h6>
                      <h6 th:text="'+63' + ${transaction.user.phoneNumber}" class="m-0 p-0"><b>Number</b></h6>
                    </div>
                    <div class="col-12 col-md-8">
                      <h6 th:text="${transaction.address}" class="m-0 p-0">Address</h6>
                    </div>
                  </div>
                </div>
                <hr>
                <h4 class="text-dark text-left">Item/s</h4>
                <th:block th:each="order : ${transaction.orderList.orders}">
                    <div th:replace="fragments/item-order :: item-order"></div>
                </th:block>
                <div class="text-right w-100 m-0 p-2 text-dark">
                    <div class="row m-0 p-0">
                        <div class="m-0 p-0 col-12 col-lg-9 col-md-6 col-sm-3"></div>
                        <div class="m-0 p-1 col-12 col-lg-3 col-md-6 col-sm-9" style="clear: both">
                            <h6 style="float: left">Order Subtotal: </h6>
                            <h6 th:text="₱ + ' ' + ${total}" style="float: right">₱ 0.0</h6>
                        </div>
                        <hr />
                        <div class="m-0 p-0 col-12 col-lg-9 col-md-6 col-sm-3"></div>
                        <div class="m-0 p-1 col-12 col-lg-3 col-md-6 col-sm-9" style="clear: both">
                            <h6 style="float: left">Shpping total: </h6>
                            <h6 th:text="₱ + ' ' + ${transaction.shippingTotal}" style="float: right">0.0</h6>
                        </div>
                        <hr />
                        <div class="m-0 p-0 col-12 col-lg-9 col-md-6 col-sm-3"></div>
                        <div class="m-0 p-1 col-12 col-lg-3 col-md-6 col-sm-9" style="clear: both">
                            <h6 style="float: left">Total Payment: </h6>
                            <h4 th:text="₱ + ' ' + (${total} + ${transaction.shippingTotal})" style="float: right">₱ 0.0</h4>
                        </div>
                    </div>
                </div>
                <hr>
                <th:block th:switch="${#request.userPrincipal.principal.getRole}">
                    <div th:if="${transaction.deliveryStatus} == 'To deliver and pay'" th:case="buyer" class="w-100 text-right m-0 p-3">
                        <button type="button" onclick="cancelOrder(id)" th:id="${transaction.id}" class="btn btn-danger">Cancel Order</button>
                    </div>
                    <div th:if="${transaction.deliveryStatus} == 'To deliver and pay'" th:case="driver" class="w-100 text-right m-0 p-3">
                        <button type="button" onclick="deliveredOrder(id)" th:id="${transaction.id}" class="btn btn-success">Order Delivered</button>
                    </div>
                </th:block>
            </div>
        </div>
    </body>
    <script th:inline="javascript">
        function cancelOrder(id){
            var parameter = "?transaction=" + id;
            $.get("/cancel-order" + parameter, function(data){
                window.location.assign("/my-order");
            });
        }
        function deliveredOrder(id){
            var parameter = "?transaction=" + id;
            $.get("/delivered-order" + parameter, function(data){
                window.location.assign("/deliveries");
            });
        }
    </script>
</html>